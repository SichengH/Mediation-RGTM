for(j in 1:n){
tryCatch({
print(paste("1",j))
e1.te2<-NULL
e1.te<-NULL
e1.pnde<-NULL
e1.tnde<-NULL
e1.pnie<-NULL
e1.tnie<-NULL
e1.pm<-NULL
e1.beta0<-NULL
e1.beta1<-NULL
e1.beta2<-NULL
e1.sigma<-NULL
e1.theta1<-NULL
e1.theta2<-NULL
e1.theta3<-NULL
e1.theta4<-NULL
cutoff<-c(90,110,130,150,1000)
for(i in 1:5){
data<-simulation.function.v6(20000,cutoff = cutoff[i])
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(t.theta0+t.theta1*data$drug+
t.theta2*data$ldlc12m+
t.theta3*data$ldlc12m*data$drug))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc12",
cvar = NULL,
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = NULL,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = T,
casecontrol = FALSE)
summ1<-summary(fit1)
te.fit<-survreg(Surv(y1,cen)~drug+ldlcb,data = data,dist = "weibull")
e1.te2[i]<-te.fit$coefficients[2]
e1.te[i]<-summ1$summary_myreg[6]
e1.pnde[i]<-summ1$summary_myreg[2]
e1.tnie[i]<-summ1$summary_myreg[3]
e1.tnde[i]<-summ1$summary_myreg[4]
e1.pnie[i]<-summ1$summary_myreg[5]
e1.pm[i]<-summ1$summary_myreg[7]
e1.beta0[i]<-fit1$mreg_fit$coefficients[1]
e1.beta1[i]<-fit1$mreg_fit$coefficients[2]
# e1.beta2[i]<-fit1$mreg_fit$coefficients[3]
e1.sigma[i]<-summ1$summary_mreg_fit$sigma
e1.theta1[i]<-fit1$yreg_fit$coefficients[2]
e1.theta2[i]<-fit1$yreg_fit$coefficients[3]
e1.theta3[i]<-fit1$yreg_fit$coefficients[4]
# e1.theta4[i]<-fit1$yreg_fit$coefficients[4]
}
results<-data.frame(cutoff,
e1.te2,e1.te,e1.pnde,e1.tnie,e1.tnde,e1.pnie,e1.pm,
e1.beta0,e1.beta1,e1.sigma,
e1.theta1,e1.theta2,e1.theta3,
interaction = 1)
results$iter<-j
rd11<-rbind(rd11,results)
}, error=function(e){} )
}
View(rd11)
t.theta1
#outcome regression AFT
t.theta0<<-7.5
t.theta1<<-0.0 #direct effect, positive is protective
t.theta2<<--0.015  #effect * ldlc_change; negative is protective
t.theta3<<-0.02 # ldlc_change * drug assume no effect
t.theta4<<--0.02 # cov
n<-1000
rd11<-NULL
set.seed(1)
for(j in 1:n){
tryCatch({
print(paste("1",j))
e1.te2<-NULL
e1.te<-NULL
e1.pnde<-NULL
e1.tnde<-NULL
e1.pnie<-NULL
e1.tnie<-NULL
e1.pm<-NULL
e1.beta0<-NULL
e1.beta1<-NULL
e1.beta2<-NULL
e1.sigma<-NULL
e1.theta1<-NULL
e1.theta2<-NULL
e1.theta3<-NULL
e1.theta4<-NULL
cutoff<-c(90,110,130,150,1000)
for(i in 1:5){
data<-simulation.function.v6(20000,cutoff = cutoff[i])
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(t.theta0+t.theta1*data$drug+
t.theta2*data$ldlc12m+
t.theta3*data$ldlc12m*data$drug))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc12",
cvar = NULL,
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = NULL,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = T,
casecontrol = FALSE)
summ1<-summary(fit1)
te.fit<-survreg(Surv(y1,cen)~drug+ldlcb,data = data,dist = "weibull")
e1.te2[i]<-te.fit$coefficients[2]
e1.te[i]<-summ1$summary_myreg[6]
e1.pnde[i]<-summ1$summary_myreg[2]
e1.tnie[i]<-summ1$summary_myreg[3]
e1.tnde[i]<-summ1$summary_myreg[4]
e1.pnie[i]<-summ1$summary_myreg[5]
e1.pm[i]<-summ1$summary_myreg[7]
e1.beta0[i]<-fit1$mreg_fit$coefficients[1]
e1.beta1[i]<-fit1$mreg_fit$coefficients[2]
# e1.beta2[i]<-fit1$mreg_fit$coefficients[3]
e1.sigma[i]<-summ1$summary_mreg_fit$sigma
e1.theta1[i]<-fit1$yreg_fit$coefficients[2]
e1.theta2[i]<-fit1$yreg_fit$coefficients[3]
e1.theta3[i]<-fit1$yreg_fit$coefficients[4]
# e1.theta4[i]<-fit1$yreg_fit$coefficients[4]
}
results<-data.frame(cutoff,
e1.te2,e1.te,e1.pnde,e1.tnie,e1.tnde,e1.pnie,e1.pm,
e1.beta0,e1.beta1,e1.sigma,
e1.theta1,e1.theta2,e1.theta3,
interaction = 1)
results$iter<-j
rd11<-rbind(rd11,results)
}, error=function(e){} )
}
View(rd11)
setwd("/Users/sh/Documents/GitHub/Mediation-RGTM/")
fwrite(rd11,file = "v3-3.csv")
library(ggplot2)
library(dplyr)
library(data.table)
library(survival)
library(DiagrammeR)
library(ggridges)
library(tidyr)
ggplot(data = data, aes(x = e1.beta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
facet_wrap(~method)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = rd11, aes(x = e1.beta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
facet_wrap(~method)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = rd11, aes(x = e1.beta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
data<-rd.11
data<-rd.11
rd.11<-fread("v3-3.csv")
rd.11$cutoff<-as.factor(rd.11$cutoff)
levels(rd.11$cutoff)[5]<-"No cutoff"
rd.11$cutoff.n<-as.numeric(rd.11$cutoff)
data<-rd.11
data$cutoff<-as.factor(data$cutoff)
levels(data$cutoff)[5]<-"No cutoff"
data$cutoff.n<-as.numeric(data$cutoff)
ggplot(data = data, aes(x = e1.beta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = data, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = data, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = data, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
t.theta3
t.theta2
ggplot(data = data, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:10),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
t.theta2
p<<-1.4
#outcome regression AFT
t.theta0<<-7.5
t.theta1<<-0.0 #direct effect, positive is protective
t.theta2<<--0.015  #effect * ldlc_change; negative is protective
t.theta3<<-0.0 # ldlc_change * drug assume no effect
t.theta4<<-0 # cov
n<-1000
rd11<-NULL
set.seed(1)
for(j in 1:n){
tryCatch({
print(paste("1",j))
e1.te2<-NULL
e1.te<-NULL
e1.pnde<-NULL
e1.tnde<-NULL
e1.pnie<-NULL
e1.tnie<-NULL
e1.pm<-NULL
e1.beta0<-NULL
e1.beta1<-NULL
e1.beta2<-NULL
e1.sigma<-NULL
e1.theta1<-NULL
e1.theta2<-NULL
e1.theta3<-NULL
e1.theta4<-NULL
cutoff<-c(90,110,130,150,1000)
for(i in 1:5){
data<-simulation.function.v6(20000,cutoff = cutoff[i])
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(t.theta0+t.theta1*data$drug+
t.theta2*data$ldlc12m+
t.theta3*data$ldlc12m*data$drug))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc12",
cvar = NULL,
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = NULL,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = T,
casecontrol = FALSE)
summ1<-summary(fit1)
te.fit<-survreg(Surv(y1,cen)~drug+ldlcb,data = data,dist = "weibull")
e1.te2[i]<-te.fit$coefficients[2]
e1.te[i]<-summ1$summary_myreg[6]
e1.pnde[i]<-summ1$summary_myreg[2]
e1.tnie[i]<-summ1$summary_myreg[3]
e1.tnde[i]<-summ1$summary_myreg[4]
e1.pnie[i]<-summ1$summary_myreg[5]
e1.pm[i]<-summ1$summary_myreg[7]
e1.beta0[i]<-fit1$mreg_fit$coefficients[1]
e1.beta1[i]<-fit1$mreg_fit$coefficients[2]
# e1.beta2[i]<-fit1$mreg_fit$coefficients[3]
e1.sigma[i]<-summ1$summary_mreg_fit$sigma
e1.theta1[i]<-fit1$yreg_fit$coefficients[2]
e1.theta2[i]<-fit1$yreg_fit$coefficients[3]
e1.theta3[i]<-fit1$yreg_fit$coefficients[4]
# e1.theta4[i]<-fit1$yreg_fit$coefficients[4]
}
results<-data.frame(cutoff,
e1.te2,e1.te,e1.pnde,e1.tnie,e1.tnde,e1.pnie,e1.pm,
e1.beta0,e1.beta1,e1.sigma,
e1.theta1,e1.theta2,e1.theta3,
interaction = 1)
results$iter<-j
rd11<-rbind(rd11,results)
}, error=function(e){} )
}
setwd("/Users/sh/Documents/GitHub/Mediation-RGTM/")
fwrite(rd11,file = "v3-2.csv")
rd32<-fread("v3-2.csv")
rd33<-fread("v3-3.csv")
rd32<-fread("v3-2.csv")
rd33<-fread("v3-3.csv")
View(rd32)
rd32$cutoff<-as.factor(rd32$cutoff)
levels(data$rd32)[5]<-"No cutoff"
rd32$cutoff.n<-as.numeric(rd32$cutoff)
rd32$cutoff<-as.factor(rd32$cutoff)
levels(rd32$cutoff)[5]<-"No cutoff"
rd32$cutoff.n<-as.numeric(rd32$cutoff)
ggplot(data = rd32, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
rd33$cutoff<-as.factor(rd33$cutoff)
levels(rd33$cutoff)[5]<-"No cutoff"
rd33$cutoff.n<-as.numeric(rd33$cutoff)
ggplot(data = rd33, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("Beta1")
ggplot(data = rd32, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
rd33$cutoff<-as.factor(rd33$cutoff)
ggplot(data = rd32, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
t.theta3
ggplot(data = rd32, aes(x = e1.pm, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.pm, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.pm, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.pm, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta1, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta2, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd32, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
ggplot(data = rd33, aes(x = e1.theta3, y = cutoff.n, fill = cutoff)) +
geom_density_ridges(alpha = 0.5)+
scale_y_discrete(limit = c(1:5),labels = data$cutoff)+
coord_flip()+
theme(legend.position = "bottom",axis.text.x = element_blank(),
axis.title.x=element_blank())+
xlab("Treatment on Mediator")+
ggtitle("theta3")
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v4.R')
setwd("/Users/sh/Documents/GitHub/Mediation-RGTM/")
fwrite(rd11,file = "v3-1.csv")
