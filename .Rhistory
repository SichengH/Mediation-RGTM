install.packages("tidyr")
install.packages("ggplot2")
install.packages("data.table")
install.packages("Rcpp")
install.packages("survival")
install.packages("devtools")
simulation.function.v5<-function(sample.size = 20000,cutoff = 1000){
n<-sample.size/2
osp = 2
n0<-0
n1<-0
data0<-NULL
data1<-NULL
#control arm
for(i in 1:100){
#print(i)
if(n0<n){
ldlcm=rnorm(n = n*osp,mean = 116,sd = 14.2)#mean distribution of LDLC
d0<-data.frame(ldlcm,ldlcb=rnorm(n = n*osp,mean = ldlcm,sd = 16))
d0<-d0%>%filter(ldlcb<cutoff)
data0<-rbind(data0,d0)
n0<-nrow(data0)
} else {
break
}
}
data0<-data0[1:n,]
#data0$ldlc12m<-data0$ldlcm+rnorm(n,0,10)#12m has higher variacne then ldlcm due to possible life style change after entering the trial
data0$ldlc12<-rnorm(n = n,mean = data0$ldlcm,sd = 16)
#treatment arm
for(i in 1:100){
#print(i)
if(n1<n){
ldlcm=rnorm(n = n*osp,mean = 116,sd = 14.2)
d1<-data.frame(ldlcm,ldlcb=rnorm(n = n*osp,mean = ldlcm,sd = 16))
d1<-d1%>%filter(ldlcb<cutoff)
data1<-rbind(data1,d1)
n1<-nrow(data1)
} else {
break
}
}
data1<-data1[1:n,]
data1$ldlc12<-data1$ldlcm - 47 + rnorm(n,0,16)
data0$drug = 0
data1$drug = 1
data = rbind(data0,data1)
data<-data%>%mutate(ldlc_change = ldlc12 - ldlcb)
return(data)
}
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
library(ggplot2)
library(dplyr)
library(data.table)
library(survival)
library(regmedint)
install.packages("devtools") # If you do not have devtools already.
devtools::install_github("kaz-yos/regmedint")
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
source('~/Documents/GitHub/Mediation-RGTM/functions.R')
library(ggplot2)
library(dplyr)
library(data.table)
library(survival)
library(DiagrammeR)
library(regmedint)
#Set Up
p<<-1.4
#outcome regression AFT
theta0<<-7.5
theta1<<-0.0  #direct effect, positive is protective
theta2<<-0.015  #effect * ldlc_change; negative is protective
theta3<<-0 # ldlc_change * drug assume no effect
theta4<<--0.02 # cov
# theta0_ni<<-7.7
# theta1_ni<<-0.59
# theta2_ni<<-0.0032 #should be negative
cutoff<-c(90,110,130,150,1000)
#
data<-simulation.function.v4(20000,cutoff = cutoff[5])
data$ldlc_change<-data$ldlc12 - data$ldlcb
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change+
theta3*data$ldlc_change*data$drug+
theta4*data$ldlcb))
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change_m+
theta3*data$ldlc_change_m*data$drug+
theta4*data$ldlcb))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
setwd("/Users/sh/Documents/GitHub/Mediation-RGTM/")
fwrite(rd11,file = "v2-3.csv")
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
#
data<-simulation.function.v4(20000,cutoff = cutoff[5])
data$ldlc_change<-data$ldlc12 - data$ldlcb
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change_m+
theta3*data$ldlc_change_m*data$drug+
theta4*data$ldlcb))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change_m",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
View(data)
plot(data$ldlc12m)
plot(data$ldlc12)
plot(data$ldlcb,data$ldlc12)
plot(data$ldlcb,data$ldlc12m)
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
#
data<-simulation.function.v4(20000,cutoff = cutoff[1])
data$ldlc_change<-data$ldlc12 - data$ldlcb
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change_m+
theta3*data$ldlc_change_m*data$drug+
theta4*data$ldlcb))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change_m",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc12m",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc12",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
plot(data$ldlc_change,data$ldlc_change_m)
#
data<-simulation.function.v4(20000,cutoff = cutoff[5])
data$ldlc_change<-data$ldlc12 - data$ldlcb
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change_m+
theta3*data$ldlc_change_m*data$drug+
theta4*data$ldlcb))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
plot(data$ldlc_change,data$ldlc_change_m)
#
data<-simulation.function.v42(20000,cutoff = cutoff[5])
data$ldlc_change<-data$ldlc12 - data$ldlcb
data$ldlc_change_m<-data$ldlc12m - data$ldlcm
data0<-data%>%filter(drug == 0)
data1<-data%>%filter(drug == 1)
data$cen<-rep(1,20000)
data$y1<-rweibull(20000,shape = 1/p,scale = exp(theta0+theta1*data$drug+
theta2*data$ldlc_change_m+
theta3*data$ldlc_change_m*data$drug+
theta4*data$ldlcb))
fit1<-regmedint(data = data,
## Variables
yvar = "y1",
avar = "drug",
mvar = "ldlc_change",
cvar = c("ldlcb"),
eventvar = "cen",
## Values at which effects are evaluated
a0 = 0,
a1 = 1,
m_cde = 0,
c_cond = 120,
## Model types
mreg = "linear",
#yreg = "survCox",
yreg = "survAFT_weibull",
## Additional specification
interaction = TRUE,
casecontrol = FALSE)
summ<-summary(fit1)
summ
plot(data$ldlc_change,data$ldlc_change_m)
table(data$y1,data$drug)
table(data$cen,data$drug)
plot(data$ldlc_change,data$ldlc_change_m)
plot(data0$ldlc_change,data0$ldlc_change_m)
mean(data0$ldlc_change_m)
mean(data0$ldlc_change)
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
setwd("/Users/sh/Documents/GitHub/Mediation-RGTM/")
fwrite(rd11,file = "v2-4.csv")
source('~/Documents/GitHub/Mediation-RGTM/Adjust_RTM_v2.R')
